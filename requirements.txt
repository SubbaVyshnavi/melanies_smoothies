# Import python packages

snowflake-snowpark-python
streamlit
import streamlit as st
from snowflake.snowpark.context import get_active_session

# Write directly to the app
st.title(f" :cup_with_straw: Pending Smoothie Orders :cup_with_straw: ")
st.write(
  """Orders that need to filled
  """
)


#title=st.text_input('Name of the title')
#st.write('The name of the title is: ',title)
from snowflake.snowpark.functions import col,when_matched

session=get_active_session()
my_data=session.table("SMOOTHIES.PUBLIC.ORDERS").filter(col("order_filled")==0).collect()
st.data_editor(my_data)


#s2=st.multiselect("Choose 5 fruits:",my_data)
s1=st.button("Submit")


if s1:
    og_dataset = session.table("smoothies.public.orders")
    edited_dataset = session.create_dataframe(my_data)
    try:
        og_dataset.merge(edited_dataset
                        , (og_dataset['ORDER_UID'] == edited_dataset['ORDER_UID'])
                        , [when_matched().update({'ORDER_FILLED': edited_dataset['ORDER_FILLED']})]
                        )
        st.success('Order (s) Update')
    except:
        st.write('Something went wrong')
else:
    st.write('There is no pending orders now')


